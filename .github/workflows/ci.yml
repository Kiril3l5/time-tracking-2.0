   name: CI

   on:
     push:
       branches: [main]
     pull_request:
       branches: [main]

   jobs:
     test:
       runs-on: ubuntu-latest
       steps:
         - uses: actions/checkout@v3
         - uses: pnpm/action-setup@v2
           with:
             version: 8
         - uses: actions/setup-node@v3
           with:
             node-version: 18
             cache: 'pnpm'
         - name: Install dependencies
           run: pnpm install
         - name: Type check
           run: pnpm type-check
         - name: Lint
           run: pnpm lint
         - name: Test
           run: pnpm test

     preview:
       if: github.event_name == 'pull_request'
       needs: test
       runs-on: ubuntu-latest
       steps:
         - uses: actions/checkout@v3
         - uses: pnpm/action-setup@v2
           with:
             version: 8
         - uses: actions/setup-node@v3
           with:
             node-version: 18
             cache: 'pnpm'
         - name: Install dependencies
           run: pnpm install
         - name: Build
           run: pnpm build
         - name: Deploy Preview
           uses: FirebaseExtended/action-hosting-deploy@v0
           with:
             repoToken: '${{ secrets.GITHUB_TOKEN }}'
             firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT }}'
             projectId: autonomy-heroes
             channelId: pr-${{ github.event.number }}