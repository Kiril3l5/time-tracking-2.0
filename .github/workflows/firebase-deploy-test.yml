# Test workflow for Firebase Deployment using temporary fixes
# This is a modified version for testing purposes only

name: Test Firebase Deployment

on:
  # Manual trigger only for testing
  workflow_dispatch:

jobs:
  test-deployment:
    runs-on: ubuntu-latest
    permissions:
      contents: 'read'
      id-token: 'write'
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup PNPM
        uses: pnpm/action-setup@v2
        with:
          version: 8
          run_install: false
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'
      
      - name: Install dependencies
        run: pnpm install
      
      # Skip linting for now
      # - name: Lint
      #   run: pnpm run lint
      
      # Skip tests for now
      # - name: Test
      #   run: pnpm run test
      
      # Create placeholder build files instead of actual build
      - name: Create empty build directories
        run: pnpm run create:empty-builds
      
      # Authenticate with Google Cloud using Workload Identity Federation
      - name: Authenticate to Google Cloud
        id: auth
        uses: google-github-actions/auth@v1
        with:
          workload_identity_provider: 'projects/266526530869/locations/global/workloadIdentityPools/github-pool/providers/github-provider'
          service_account: 'github-actions-sa@autonomy-heroes.iam.gserviceaccount.com'
      
      # Install Firebase CLI
      - name: Setup Firebase CLI
        run: npm install -g firebase-tools
      
      # Deploy to test channel
      - name: Deploy to Test Channel
        run: firebase hosting:channel:deploy github-test-${{ github.run_id }} --expires 1d
      
      - name: Report Success
        run: |
          echo "âœ… Test deployment successful!"
          echo "Test channel: github-test-${{ github.run_id }}" 